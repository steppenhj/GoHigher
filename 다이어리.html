<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>투자 다이어리 | Go Higher – 나만의 투자일지, 자산 추이, 체크리스트, 캘린더 관리</title>
<meta name="description" content="나만의 투자 성장 다이어리! Go Higher에서 투자일지, 자산·수익 추이, 투자 체크리스트, 투두, 일정 캘린더까지 쉽고 편하게 기록하고 관리하세요. 투자습관 만들기, 자산관리, 성공투자 한 번에.">
<meta name="keywords" content="투자 다이어리, 투자일지, 투자 기록, 자산 추이, 수익률, 체크리스트, 투자 투두, 투자 캘린더, 투자 습관, 주식 기록, 미국주식 관리, 투자 성장, 투자 노트, Go Higher, 자산 관리 서비스">
<link rel="canonical" href="https://gohigher.kr/다이어리.html" />

<!-- 사이트 검증 -->
<meta name="naver-site-verification" content="daa71973aba155bc2d96dfde44d8fb34b6a74ba7" />
<meta name="google-site-verification" content="GGuWsc5cbeYC9W0nQsN7550kWcUzArKuo3zfhjN5LXE" />

<!-- Open Graph (카카오/페북/SNS 공유 최적화) -->
<meta property="og:type" content="website" />
<meta property="og:title" content="Go Higher 투자 다이어리 – 나만의 투자 성장 기록" />
<meta property="og:description" content="투자일지부터 자산추이, 체크리스트, 캘린더까지 내 투자 라이프를 체계적으로 관리! Go Higher에서 투자습관을 만들어보세요." />
<meta property="og:image" content="https://gohigher.kr/logo.jpg" />
<meta property="og:url" content="https://gohigher.kr/다이어리.html" />
<meta property="og:site_name" content="Go Higher" />
<meta property="og:locale" content="ko_KR" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Go Higher 투자 다이어리 – 나만의 투자 성장 기록" />
<meta name="twitter:description" content="나만의 투자일지, 자산 및 수익 관리, 체크리스트, 일정 캘린더를 한 곳에서! Go Higher 투자 다이어리에서 습관을 만들어보세요." />
<meta name="twitter:image" content="https://gohigher.kr/logo.jpg" />

<!-- 추가 권장 태그 -->
<meta name="author" content="Go Higher" />
<meta name="robots" content="index,follow" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="/logo.jpg" type="image/jpeg" />
    
   <link rel="stylesheet" href="navigation.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700;400&display=swap" rel="stylesheet">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>  

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
  // --- 반드시 가장 위에 삽입 ---
  const firebaseConfig = {
    apiKey: "AIzaSyCgFLtAo8LETpHq44hxlT7QigCbIltk-Zk",
    authDomain: "gohigher-55e51.firebaseapp.com",
    projectId: "gohigher-55e51",
    storageBucket: "gohigher-55e51.appspot.com",
    messagingSenderId: "487435343721",
    appId: "1:487435343721:web:dc5708c3a263214fba4ff8",
    measurementId: "G-KQ02L8DXG0"
  };
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
</script>

  <style>
    :root {
      --yellow: #ffe066;
      --yellow-dark: #ffbe44;
      --bg-dark: #232b3e;
      --bg-section: rgba(30,40,68,0.97);
      --font: #f9f9d6;
      --font-soft: #b7caf8;
      --border: #ffe06638;
      --accent: #84e4bc;
      --err: #fd7d7b;
      --shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
      --card-glow: 0 0 24px 0 rgba(255,224,102,0.10), 0 2px 24px 0 rgba(132,228,188,0.10);
      --blur-bg: blur(7px) saturate(1.2);
      --tab-gradient: linear-gradient(90deg, #ffe066 0%, #84e4bc 100%);
    }
    .diary-hub {
      max-width: 1000px;
      max-height: auto;
      margin: 0 auto; padding: 48px 10px 36px 10px;
      text-align: center;
    }
    .diary-title {
      margin-top: 5rem;
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 12px;
      letter-spacing: -0.01em;
      border-right: 2px solid var(--yellow);
      animation: blink 0.85s steps(1) infinite;
      background: linear-gradient(90deg, #ffe066 60%, #84e4bc 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
      filter: drop-shadow(0 2px 8px #ffe06644);
      text-shadow: 0 2px 12px #ffe06633;
    }
    @keyframes blink {0%,100%{border-color:var(--yellow);}50%{border-color:transparent;}}
    .diary-desc {
      font-size: 1.08rem;
      color: var(--font-soft);
      margin-bottom: 22px;
      max-width: 420px;
      margin-left: auto; margin-right: auto;
      line-height: 1.5;
      background:rgba(40,50,90,0.13);
      border-radius:10px;
      padding:10px 0;
      box-shadow: 0 2px 12px #232b3e22;
    }
    /* 탭 네비게이션 */
    .diary-tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 22px;
      background: none;
    }
    .diary-tab {
      background: none;
      border: none;
      color: var(--font-soft);
      font-size: 1.05rem;
      font-weight: 900;
      padding: 10px 22px 8px 22px;
      border-radius: 16px 16px 0 0;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, box-shadow 0.18s, transform 0.13s;
      outline: none;
      border-bottom: 2px solid transparent;
      position: relative;
      z-index: 1;
      letter-spacing: -0.01em;
      box-shadow: 0 2px 8px #ffe06611;
      margin-bottom: -2px;
    }
    .diary-tab .tab-icon {
      margin-right: 6px;
      font-size: 1.05em;
      vertical-align: -2px;
    }
    .diary-tab.active {
      color: #232b3e;
      background: var(--tab-gradient);
      border-bottom: 2px solid var(--yellow);
      box-shadow: 0 4px 18px #ffe06633, 0 2px 12px #84e4bc22;
      z-index: 2;
      transform: translateY(-2px) scale(1.03);
    }
    .diary-tab:active {
      transform: scale(0.98);
    }
    /* 탭 컨텐츠 */
    .diary-tab-content {
      display: none;
      animation: fadeIn 0.4s;
    }
    .diary-tab-content.active {
      display: block;
      animation: fadeIn 0.4s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: none; }
    }
    .diary-card {
      background: var(--bg-section);
      border-radius: 18px;
      box-shadow: var(--shadow), var(--card-glow);
      padding: 32px 18px 22px 18px;
      border: 1.5px solid var(--border);
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      margin-bottom: 8px;
      position: relative;
      transition: box-shadow 0.22s, background 0.18s, transform 0.18s;
      backdrop-filter: var(--blur-bg);
      border-top: 2.5px solid var(--yellow-dark);
    }
    .diary-card-title {
      font-size: 1.18rem;
      font-weight: 900;
      color: var(--yellow);
      margin-bottom: 13px;
      letter-spacing: -0.01em;
      display: flex; align-items: center; gap: 8px;
      text-shadow: 0 2px 8px #ffe06633;
    }
    .diary-save-btn, .checklist-add-btn, .todo-add-btn, .asset-save-btn {
      background: var(--tab-gradient);
      color: #232b3e;
      border-radius: 12px; border: none; padding: 12px 0;
      font-size: 1.08rem; font-weight: 900;
      cursor: pointer; transition: background 0.18s, box-shadow 0.18s, transform 0.13s;
      width: 100%; margin-top: 2px;
      box-shadow: 0 4px 16px rgba(255, 224, 102, 0.22);
    }
    .diary-save-btn:active, .checklist-add-btn:active, .todo-add-btn:active, .asset-save-btn:active {
      background: var(--yellow-dark);
      transform: scale(0.98);
    }
    .diary-save-btn:hover, .checklist-add-btn:hover, .todo-add-btn:hover, .asset-save-btn:hover {
      background: linear-gradient(90deg, var(--yellow-dark), var(--yellow));
      box-shadow: 0 8px 24px #ffe06666;
      transform: scale(1.03);
    }
    .diary-textarea, .emotion-textarea, .checklist-input, .todo-input, .asset-date-input, .asset-value-input, #calendarMemoInput {
      border-radius: 10px;
      border: 1.5px solid var(--border);
      padding: 12px;
      font-size: 1.08rem;
      background: rgba(35,41,72,0.98);
      color: var(--yellow);
      margin-bottom: 10px; margin-top: 4px;
      font-family: inherit;
      resize: vertical;
      transition: border-color 0.19s, background 0.19s, box-shadow 0.18s;
      box-shadow: 0 2px 12px #ffe06622;
      backdrop-filter: blur(2px);
    }
    .diary-textarea:focus, .emotion-textarea:focus, .checklist-input:focus, .todo-input:focus, .asset-date-input:focus, .asset-value-input:focus, #calendarMemoInput:focus {
      border-color: var(--yellow-dark);
      background: #2a3b62;
      box-shadow: 0 4px 18px #ffe06644;
    }
    /* 기타 기존 스타일 유지, 일부 크기 축소 */
    .asset-list-table {width:100%;font-size:1em;margin:10px 0; background:rgba(35,41,72,0.92); border-radius:8px; box-shadow:0 2px 8px #ffe06622;}
    .asset-list-table td, .asset-list-table th {padding:7px 10px;text-align:right; font-size:1em;}
    .asset-list-table th {color:var(--yellow); font-weight:900; font-size:1.05em;}
    .asset-list-table td.delbtn {text-align:center;}
    .calendar-area {background: #232b3e;border-radius:12px;min-height:60px;color:var(--font-soft);box-shadow:0 2px 8px #ffe06622;}
    #calendar { width: 100%; min-width: 220px; max-width: 100%; margin: 0 auto 0.5rem auto; }
    .calendar-table {width:100%;border-collapse:collapse;}
    .calendar-table th,.calendar-table td{ text-align:center;width:14.2%;height:32px;font-size:1.02rem;border-radius:7px;}
    .calendar-table th { color: var(--yellow); font-weight:900; background:rgba(255,224,102,0.04);}
    .calendar-table td { color: #fff; cursor:pointer; transition: background 0.13s, color 0.13s;}
    .calendar-table td.today{ background: #ffe06633; color:var(--yellow);font-weight:900;}
    .calendar-table td.has-memo{color:#222c46;background:#fff066cc; font-weight:700;}
    .calendar-table td:hover:not(.empty) {background: #3d4a74; color:var(--yellow);}
    .calendar-table td.empty { background:none; cursor:default;}
    #calendarMemoBox { background:#222a44;padding:10px;border-radius:10px;box-shadow:0 2px 8px #ffe06622;}
    /* 체크/투두 */
    .diary-checklist, .diary-todo-list {list-style:none;padding:0;margin-bottom:10px;}
    .diary-checklist li, .diary-todo-list li {display:flex;align-items:center;gap:8px;margin-bottom:6px; background:rgba(255,224,102,0.04); border-radius:7px; padding:5px 8px; font-size:1em;}
    .diary-checklist input[type="checkbox"], .diary-todo-list input[type="checkbox"]{ accent-color: var(--yellow); width:1em;height:1em;}
    .delbtn {background:none;border:none;color:var(--err);cursor:pointer; font-size:1.05em;}
    .delbtn:hover {color:#fff;}
    @media (max-width: 900px) {
      .diary-hub {max-width: 98vw;}
      .diary-title {font-size:1.2rem;}
      .diary-card {padding:14px 4px 10px 4px; border-radius:10px;}
      .diary-tabs {gap:2px;}
      .diary-tab {font-size:0.95rem;padding:6px 6px; border-radius:8px 8px 0 0;}
      .diary-card-title {font-size:1rem;}
    }
    @media (max-width: 600px) {
      .diary-hub {padding: 12px 2px 10px 2px;}
      .diary-title {font-size:1.1rem;}
      .diary-card {padding:8px 2px 6px 2px; border-radius:10px;}
      .diary-tabs {gap:2px;}
      .diary-tab {font-size:0.95rem;padding:6px 6px; border-radius:8px 8px 0 0;}
      .diary-card-title {font-size:1rem;}
    }
    .toast { position:fixed;bottom:33px;left:50%;transform:translateX(-50%);
      background:var(--yellow);color:#232b3e;padding:11px 27px;font-weight:900;border-radius:14px;font-size:1.07em;
      z-index:10000;box-shadow:0 5px 18px #0003;opacity:0.97;animation:toastShow 1.6s;}
    @keyframes toastShow {0%{transform:translateY(16px) scale(0.98);opacity:0;}30%{opacity:1;}100%{opacity:0.96;}}
 #diaryTypingTitle {
  border-right: 2.5px solid var(--yellow);
  animation: blink 0.8s steps(1) infinite;
  white-space: nowrap;
  overflow: hidden;
}
  </style>
</head>
<body>
<nav class="nav">
  <div class="nav-left">
    <button class="hamburger-btn" id="openSidebarBtn" aria-label="메뉴 열기">
      <svg viewBox="0 0 22 22">
        <rect y="4" width="22" height="1.3" rx="0.6" fill="#e9f1ff"/>
        <rect y="10" width="22" height="1.3" rx="0.6" fill="#e9f1ff"/>
        <rect y="16" width="22" height="1.3" rx="0.6" fill="#e9f1ff"/>
      </svg>
    </button>
    <span class="brand">Go Higher</span>
    <div class="nav-menu">
      <a href="/" class="nav-link">홈</a>
      <a href="/뉴스.html" class="nav-link">뉴스</a>
      <a href="/다이어리.html" class="nav-link active">다이어리</a>
      <a href="/시리즈.html" class="nav-link">시리즈</a>
      <a href="/멤버십.html" class="nav-link">멤버십</a>
    </div>
  </div>
  <div class="nav-right" id="navRight">
    <div class="stock-search">
  <input
    id="stockSearchInput"
    type="text"
    placeholder="티커/심볼 (예: AAPL, MSFT)"
    autocomplete="off"
    style="width:180px;max-width:220px;"
  />
  <button
    class="btn stock-btn"
    id="stockSearchBtn"
    aria-label="주식 검색"
    title="주식 검색"
    style="margin-left:-2px;"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="icon-search" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
      <path fill-rule="evenodd" d="M11 4a7 7 0 014.899 11.899l4.6 4.6a1 1 0 01-1.414 1.414l-4.6-4.6A7 7 0 1111 4zm0 2a5 5 0 100 10 5 5 0 000-10z" clip-rule="evenodd"/>
    </svg>
  </button>
</div>

<button class="btn" id="shareBtn">
  <span style="font-size:1.12em; margin-right:5px; vertical-align:-2px;">🔗</span>
  공유
</button>
    <a href="/login.html" class="btn login" id="loginBtn">로그인</a>
    <img id="profilePhoto" class="profile-photo" src="/logo.jpg" alt="프로필" style="display:none;" />
  </div>
</nav>

  <div class="overlay" id="sidebarOverlay"></div>
  <aside class="sidebar" id="sidebar">
    <button class="sidebar-close" id="closeSidebarBtn" aria-label="닫기">&times;</button>
    <h2>Go Higher 메뉴</h2>
    <div class="user-info">
      <span class="user-icon" style="background:#f0e85a;border-radius:50%;width:36px;height:36px;display:inline-block;vertical-align:middle;overflow:hidden;">
        <img src="" alt="프로필" class="user-photo" style="width:100%;height:100%;object-fit:cover;display:none;">
      </span>
      <div>
        <div class="user-name">비로그인</div>
        <div class="user-email" style="font-size:0.98em; color:#b7caf8; margin-top:2px;"></div>
        <div class="user-status">로그인 필요</div>
      </div>
    </div>
    <hr>
    <div>
      <a href="/마이페이지.html" class="side-link">마이페이지</a>
      <a href="/설정.html" class="side-link">설정</a>
    </div>
    <hr>
        <div>
      <a href="/" class="side-link">홈</a>
      <a href="/뉴스.html" class="side-link">뉴스</a>
      <a href="/다이어리.html" class="side-link">다이어리</a>
      <a href="/시리즈.html" class="side-link">시리즈</a>
      <a href="/멤버십.html" class="side-link">멤버십</a>
    </div>

    <a href="/login.html" class="side-link">로그아웃</a>
    <hr>
    <div class="biz-info-title">사업자 등록</div>
    <div class="biz-info">GoHigher | 대표 박해진</div>
    <div class="biz-info">대구광역시 북구 동천로 155, 네스빌101동 12층</div>
    <div class="biz-info">사업자번호 407-09-54622</div>
    <div class="biz-info">연락처 070-8080-1675</div>
    <hr>

  <!-- 정책/소개/약관 버튼 -->
  <div class="policy-links" style="margin-top:16px; padding:10px 0 2px 0; display:flex; flex-wrap:wrap; gap:12px; font-size:0.87em; color:#a2b6d8;">
    <a href="푸터/이용약관.html" class="policy-link" style="color:inherit; text-decoration:none;">이용약관</a>
    <a href="푸터/privacy-policy.html" class="policy-link" style="color:inherit; text-decoration:none;">개인정보처리방침</a>
    <a href="푸터/환불정책.html" class="policy-link" style="color:inherit; text-decoration:none;">환불정책</a>
  </div>
  <!-- 저작권 문구 -->
   <div class="copyright" style="margin-top:14px; font-size:11.8px; color:#8e9bb3; text-align:center; letter-spacing:0.01em;">
    © 2025 GoHigher. All rights reserved

</aside>

<!-- 검색 모달 -->
<div id="searchModal" class="search-modal" style="display:none; min-width:370px; max-width:99vw;">
  <button id="closeSearchModal" class="modal-close" aria-label="닫기">&times;</button>
  <h2 class="modal-title" style="margin-bottom:2px;">검색 결과</h2>
  <div id="stockModalTabs"
       style="display:flex; gap:8px; margin:10px 0 20px 0; flex-wrap:wrap;"></div>
  <div id="modalResult" class="stock-result"></div>
</div>
<div id="searchModalOverlay" class="modal-overlay" style="display:none;"></div>
  <main class="diary-hub">
    <div class="diary-title" id="diaryTypingTitle">Go Higher 투자 다이어리</div>
    <div class="diary-desc">나만의 투자 성장 기록!<br>오늘의 투자일지, 자산 추이, 일정, 체크리스트까지 한 눈에.</div>
    <div class="diary-tabs">
      <button class="diary-tab active" data-tab="diary"><span class="tab-icon">📝</span>투자일지</button>
      <button class="diary-tab" data-tab="asset"><span class="tab-icon">📈</span>자산추이</button>
      <button class="diary-tab" data-tab="checklist"><span class="tab-icon">🎯</span>체크리스트</button>
      <button class="diary-tab" data-tab="todo"><span class="tab-icon">✅</span>투두</button>
      <button class="diary-tab" data-tab="calendar"><span class="tab-icon">📅</span>캘린더</button>
    </div>
    <div class="diary-tab-content active" id="tab-diary">
      <section class="diary-card">
        <div class="diary-card-title"><i class="fa-solid fa-pen-nib"></i> 오늘의 투자 일지</div>
        <textarea class="diary-textarea" placeholder="오늘의 투자 경험, 배운 점, 감정, 아이디어를 자유롭게 적어보세요."></textarea>
        <textarea class="emotion-textarea" placeholder="오늘의 투자 감정과 매매 이유"></textarea>
        <button class="diary-save-btn">저장</button>
      </section>
    </div>
    <div class="diary-tab-content" id="tab-asset">
      <section class="diary-card diary-asset-card">
        <div class="diary-card-title"><i class="fa-solid fa-chart-line"></i> 자산·수익 추이</div>
        <form class="asset-input-form">
          <input type="date" class="asset-date-input" required>
          <input type="number" class="asset-value-input" placeholder="자산 금액(원)" min="0" required>
          <button type="submit" class="asset-save-btn">저장</button>
        </form>
        <canvas id="assetChart" style="width:100%;max-width:320px;height:120px;margin-top:10px;"></canvas>
        <table class="asset-list-table"></table>
      </section>
    </div>
    <div class="diary-tab-content" id="tab-checklist">
      <section class="diary-card">
        <div class="diary-card-title"><i class="fa-solid fa-bullseye"></i> 목표 & 체크리스트</div>
        <ul class="diary-checklist"></ul>
        <input type="text" class="checklist-input" placeholder="목표 추가">
        <button class="checklist-add-btn">추가</button>
      </section>
    </div>
    <div class="diary-tab-content" id="tab-todo">
      <section class="diary-card">
        <div class="diary-card-title"><i class="fa-solid fa-list-check"></i> 투자 할 일</div>
        <ul class="diary-todo-list"></ul>
        <input type="text" class="todo-input" placeholder="할 일 추가">
        <button class="todo-add-btn">추가</button>
      </section>
    </div>
    <div class="diary-tab-content" id="tab-calendar">
      <section class="diary-card diary-calendar-card">
        <div class="diary-card-title"><i class="fa-solid fa-calendar-days"></i> 나의 투자 캘린더</div>
        <div class="calendar-area">
          <div id="calendar"></div>
          <div id="calendarMemoBox" style="display:none;margin-top:12px;">
            <strong id="calendarMemoDate"></strong><br>
            <textarea id="calendarMemoInput" placeholder="이 날의 투자 메모를 적으세요" style="width:92%;min-height:52px;border-radius:8px;"></textarea><br>
            <button id="calendarMemoSaveBtn" style="margin-top:6px;">저장</button>
            <button id="calendarMemoCancelBtn" style="margin-top:6px;">취소</button>
          </div>
        </div>
      </section>
    </div>
  </main>
  <div id="toastBox" style="display:none;"></div>
<script src="navigation.js"></script>

<script>
  if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.firestore();


let currentUser = null;
// 최상단 한 번만!
function getToday() {
  const d = new Date();
  return d.toISOString().slice(0,10);
}
let today = getToday();
let diaryLoading = false;

// =========== 공통 함수 ===========
    // ====== Toast ======
    function toast(msg, sec=1.5) {
      const box = document.getElementById('toastBox');
      box.textContent = msg;
      box.className = 'toast';
      box.style.display = "block";
      setTimeout(()=>{box.style.display="none"}, sec*1000);
    }
    // ====== 투자일지/감정 ======
    const diaryTextarea = document.querySelector('.diary-textarea');
    const emotionTextarea = document.querySelector('.emotion-textarea');
    const diarySaveBtn = document.querySelector('.diary-save-btn');
    let diaryDirty = false;
    async function saveDiary(auto=false) {
      if (!currentUser) return;
      const text = diaryTextarea.value.trim();
      const emotion = emotionTextarea.value.trim();
      if (!text && !emotion && auto) return;
      diarySaveBtn.disabled = true;
      await db.collection('users').doc(currentUser.uid).collection('diary').doc(today)
        .set({ text, emotion, date: new Date() });
      if (!auto) toast('일지가 저장됨!');
      diarySaveBtn.disabled = false;
    }
    async function loadDiary(date=today) {
      if (!currentUser) return;
      diarySaveBtn.disabled = true;
      const doc = await db.collection('users').doc(currentUser.uid).collection('diary').doc(date).get();
      if (doc.exists) {
        diaryTextarea.value = doc.data().text||"";
        emotionTextarea.value = doc.data().emotion||"";
      } else {
        diaryTextarea.value = "";
        emotionTextarea.value = "";
      }
      diarySaveBtn.disabled = false;
    }
    ["input","change"].forEach(ev => {
      diaryTextarea.addEventListener(ev, ()=>{diaryDirty=true;});
      emotionTextarea.addEventListener(ev, ()=>{diaryDirty=true;});
    });
    setInterval(()=>{if(currentUser&&diaryDirty){saveDiary(true);diaryDirty=false;}}, 5000);
    diarySaveBtn.onclick = ()=>saveDiary(false);

    // ====== 자산/수익 추이(차트+리스트) ======
    const assetForm = document.querySelector('.asset-input-form');
    const assetDateInput = document.querySelector('.asset-date-input');
    const assetValueInput = document.querySelector('.asset-value-input');
    const assetChartCanvas = document.getElementById('assetChart');
    const assetTable = document.querySelector('.asset-list-table');
    let assetChart = null;
    assetDateInput.valueAsDate = new Date();
    assetForm.onsubmit = async (e) => {
      e.preventDefault();
      if(!currentUser) return toast('로그인 필요!');
      const date = assetDateInput.value;
      const value = parseFloat(assetValueInput.value);
      if(!date||isNaN(value)) return toast('날짜/금액 입력!');
      await db.collection('users').doc(currentUser.uid).collection('assets').doc(date)
        .set({ value, date: new Date(date+"T09:00:00Z") });
      assetValueInput.value = '';
      await loadAssetChart();
      toast('자산 저장!');
    };
    async function loadAssetChart() {
      if(!currentUser) { assetChartCanvas.style.display="none"; assetTable.innerHTML=''; return;}
      const qs = await db.collection('users').doc(currentUser.uid).collection('assets')
        .orderBy('date').limit(90).get();
      let labels = [], data = [], docs=[];
      qs.forEach(doc => {
        labels.push(doc.id); data.push(doc.data().value); docs.push({id:doc.id,val:doc.data().value});
      });
      // 차트
      if(assetChart) assetChart.destroy();
      assetChart = new Chart(assetChartCanvas, {
        type: 'line',
        data: { labels, datasets: [{ label:'자산 추이(원)', data, fill:true, tension:0.28, borderColor:'#ffe066', backgroundColor:'rgba(255,224,102,0.11)', pointRadius:3 }]},
        options: { plugins: {legend:{display:false}}, scales: {x:{grid:{display:false}}, y:{grid:{color:'#3d4a74'}} } }
      });
      // 리스트
      assetTable.innerHTML = `<tr><th>날짜</th><th>금액</th><th></th></tr>` +
        docs.map(d=>`<tr><td>${d.id}</td><td>${d.val.toLocaleString()}</td><td class="delbtn"><button class="delbtn" data-id="${d.id}">삭제</button></td></tr>`).join('');
      assetTable.querySelectorAll('.delbtn').forEach(btn=>{
        btn.onclick=async()=>{
          if(confirm('정말 삭제할까요?')){
            await db.collection('users').doc(currentUser.uid).collection('assets').doc(btn.dataset.id).delete();
            await loadAssetChart();
            toast('삭제됨');
          }
        }
      });
    }
    // ====== 체크리스트 ======
    const checklistUl = document.querySelector('.diary-checklist');
    const checklistInput = document.querySelector('.checklist-input');
    const checklistAddBtn = document.querySelector('.checklist-add-btn');
    checklistAddBtn.onclick = async () => {
      if (!currentUser) return;
      const text = checklistInput.value.trim();
      if (!text) return;
      await db.collection('users').doc(currentUser.uid)
        .collection('checklist').add({ text, checked: false, created: new Date() });
      checklistInput.value = '';
      loadChecklist();
    };
    checklistInput.onkeydown = (e) => { if(e.key==='Enter'){ e.preventDefault(); checklistAddBtn.click(); } };
    async function loadChecklist() {
      if (!currentUser) return;
      const snapshot = await db.collection('users').doc(currentUser.uid)
        .collection('checklist').orderBy('created','asc').get();
      checklistUl.innerHTML = '';
      if(snapshot.empty) checklistUl.innerHTML = `<li style="color:#b7caf8;">목표 없음.</li>`;
      snapshot.forEach(doc => {
        const item = doc.data();
        const li = document.createElement('li');
        li.innerHTML = `<input type="checkbox" ${item.checked?'checked':''}> <span>${item.text}</span>
        <button class="delbtn" data-id="${doc.id}">✖️</button>`;
        li.querySelector('input').onchange = () => {
          db.collection('users').doc(currentUser.uid)
            .collection('checklist').doc(doc.id)
            .update({checked: li.querySelector('input').checked});
        };
        li.querySelector('button').onclick = () => {
          if(confirm('삭제?')) db.collection('users').doc(currentUser.uid)
            .collection('checklist').doc(doc.id).delete().then(loadChecklist);
        };
        checklistUl.appendChild(li);
      });
    }
    // ====== 투두 ======
    const todoUl = document.querySelector('.diary-todo-list');
    const todoInput = document.querySelector('.todo-input');
    const todoAddBtn = document.querySelector('.todo-add-btn');
    todoAddBtn.onclick = async () => {
      if (!currentUser) return;
      const text = todoInput.value.trim();
      if (!text) return;
      await db.collection('users').doc(currentUser.uid)
        .collection('todo').add({ text, checked: false, created: new Date() });
      todoInput.value = '';
      loadTodo();
    };
    todoInput.onkeydown = (e) => { if(e.key==='Enter'){ e.preventDefault(); todoAddBtn.click(); } };
    async function loadTodo() {
      if (!currentUser) return;
      const snapshot = await db.collection('users').doc(currentUser.uid)
        .collection('todo').orderBy('created','asc').get();
      todoUl.innerHTML = '';
      if(snapshot.empty) todoUl.innerHTML = `<li style="color:#b7caf8;">할 일 없음.</li>`;
      snapshot.forEach(doc => {
        const item = doc.data();
        const li = document.createElement('li');
        li.innerHTML = `<input type="checkbox" ${item.checked?'checked':''}> <span>${item.text}</span>
        <button class="delbtn" data-id="${doc.id}">✖️</button>`;
        li.querySelector('input').onchange = () => {
          db.collection('users').doc(currentUser.uid)
            .collection('todo').doc(doc.id)
            .update({checked: li.querySelector('input').checked});
        };
        li.querySelector('button').onclick = () => {
          if(confirm('삭제?')) db.collection('users').doc(currentUser.uid)
            .collection('todo').doc(doc.id).delete().then(loadTodo);
        };
        todoUl.appendChild(li);
      });
    }
    // ====== 캘린더 ======
    const calendarEl = document.getElementById('calendar');
    const memoBox = document.getElementById('calendarMemoBox');
    const memoInput = document.getElementById('calendarMemoInput');
    const memoDateSpan = document.getElementById('calendarMemoDate');
    const memoSaveBtn = document.getElementById('calendarMemoSaveBtn');
    const memoCancelBtn = document.getElementById('calendarMemoCancelBtn');
    let calendarYear, calendarMonth, calendarMemos = {};
    function getToday() { const d = new Date(); return d.toISOString().slice(0,10);}
    function renderCalendar(year, month) {
      calendarEl.innerHTML = "";
      const d = new Date(year, month, 1);
      const firstDay = d.getDay(), lastDate = new Date(year, month+1, 0).getDate();
      let html = `<table class="calendar-table"><thead><tr>
      <th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th>
      </tr></thead><tbody><tr>`;
      for(let i=0;i<firstDay;i++) html += `<td class="empty"></td>`;
      for(let day=1;day<=lastDate;day++){
        const dateStr = `${year}-${(month+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
        let cls = [];
        if(dateStr===getToday()) cls.push("today");
        if(calendarMemos[dateStr]) cls.push("has-memo");
        html += `<td class="${cls.join(' ')}" data-date="${dateStr}">${day}${calendarMemos[dateStr] ? " ●" : ""}</td>`;
        if((firstDay+day)%7===0) html += "</tr><tr>";
      }
      html += `</tr></tbody></table>`;
      html += `<div style="display:flex;justify-content:space-between;margin-top:2px;">
      <button id="calPrev">&lt;</button>
      <b>${year}년 ${month+1}월</b>
      <button id="calNext">&gt;</button>
      </div>`;
      calendarEl.innerHTML = html;
      document.getElementById('calPrev').onclick = ()=>drawCalendar(year, month-1);
      document.getElementById('calNext').onclick = ()=>drawCalendar(year, month+1);
      calendarEl.querySelectorAll('td[data-date]').forEach(td=>{
        td.onclick = ()=>openMemoInput(td.getAttribute('data-date'));
      });
    }
    async function loadCalendarMemos(year, month) {
      calendarMemos = {};
      if(!currentUser) return;
      const from = `${year}-${(month+1).toString().padStart(2,'0')}-01`;
      const to = `${year}-${(month+1).toString().padStart(2,'0')}-31`;
      const qs = await db.collection('users').doc(currentUser.uid).collection('calendar')
        .where('date','>=',new Date(from)).where('date','<=',new Date(to)).get();
      qs.forEach(doc => {
        calendarMemos[doc.id] = doc.data().memo;
      });
    }
    async function drawCalendar(y, m){
      calendarYear = y; calendarMonth = m;
      await loadCalendarMemos(y, m);
      renderCalendar(y, m);
    }
    function openMemoInput(dateStr){
      memoBox.style.display="block";
      memoDateSpan.textContent = dateStr;
      memoInput.value = calendarMemos[dateStr]||"";
      memoSaveBtn.onclick = async ()=>{
        if(!currentUser) return toast('로그인 필요');
        await db.collection('users').doc(currentUser.uid).collection('calendar').doc(dateStr)
          .set({memo:memoInput.value,date:new Date(dateStr)});
        memoBox.style.display="none";
        await drawCalendar(calendarYear, calendarMonth);
        toast('저장됨!');
      };
      memoCancelBtn.onclick = ()=>{ memoBox.style.display="none"; };
    }

    // ====== 인증 이벤트 ======
    auth.onAuthStateChanged((user) => {
      currentUser = user;
      today = (new Date()).toISOString().slice(0,10);
      if (!user) {
        [diarySaveBtn, checklistAddBtn, todoAddBtn].forEach(btn => btn.disabled = true);
        checklistUl.innerHTML = `<li style="color:#b7caf8;">로그인하면 내 목표를 저장할 수 있습니다.</li>`;
        todoUl.innerHTML = `<li style="color:#b7caf8;">로그인하면 할 일을 관리할 수 있습니다.</li>`;
        assetChartCanvas.style.display="none"; assetTable.innerHTML='';
      } else {
        [diarySaveBtn, checklistAddBtn, todoAddBtn].forEach(btn => btn.disabled = false);
        loadDiary(today); loadChecklist(); loadTodo(); loadAssetChart();
        const d = new Date();
        drawCalendar(d.getFullYear(), d.getMonth());
      }
    });
  </script>
<script>
  const typingTarget = document.getElementById('diaryTypingTitle');
  const textToType = "Go Higher 투자 다이어리";
  let index = 0;

  function typeWriter() {
    if(index <= textToType.length) {
      typingTarget.textContent = textToType.slice(0, index);
      index++;
      setTimeout(typeWriter, 100);
    }
  }

  window.onload = () => {
    typeWriter();
    // 탭 전환 스크립트: DOM이 완전히 로드된 후에도 정상 동작
    const tabs = document.querySelectorAll('.diary-tab');
    const tabContents = document.querySelectorAll('.diary-tab-content');
    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        const tabId = 'tab-' + this.dataset.tab;
        tabContents.forEach(c => {
          if (c.id === tabId) c.classList.add('active');
        });
      });
    });
  };
</script>

  <div style="height: 66px;"></div>
</body>
</html>