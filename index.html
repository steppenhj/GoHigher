<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í¬ì¸  ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí† íƒ€ì…</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* CSSëŠ” ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤. */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; color: #1e293b; display: flex; flex-direction: column; min-height: 100vh; margin: 0; }
        .container { width: 100%; max-width: 1280px; margin-left: auto; margin-right: auto; padding: 1rem; flex-grow: 1; }
        .view { display: none; }
        .view.active { display: block; }
        .header { display: flex; flex-direction: column; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #e2e8f0; }
        .header h1 { font-size: 1.875rem; font-weight: 700; color: #1e293b; cursor: pointer; margin-bottom: 1rem; }
        .search-area { display: flex; align-items: center; gap: 0.5rem; width: 100%; }
        .search-area input { padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; width: 100%; }
        .search-area input:focus { outline: none; box-shadow: 0 0 0 2px #34d399; }
        .search-area button { padding: 0.5rem; background-color: #334155; color: white; border: none; border-radius: 0.5rem; cursor: pointer; }
        .search-area button:hover { background-color: #1e293b; }
        .user-menu { display: flex; gap: 1rem; margin-top: 1rem; align-items: center; }
        .user-menu span { font-weight: 500; }
        .user-menu a, .user-menu button { color: #475569; text-decoration: none; background: none; border: none; cursor: pointer; font-size: 1em; font-family: inherit; font-weight: 500; padding: 0;}
        .user-menu a:hover, .user-menu button:hover { color: #059669; }
        .main-nav { background-color: white; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); padding: 0.5rem; margin-bottom: 2rem; }
        .main-nav ul { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 0.5rem; font-weight: 600; list-style: none; padding: 0; margin: 0; }
        .nav-link { padding: 0.75rem; display: block; color: #334155; border-radius: 0.5rem; text-decoration: none; cursor: pointer; }
        .nav-link:hover { background-color: #f1f5f9; }
        .nav-link.active { color: #059669; font-weight: 700; }
        .sports-gallery-menu { position: relative; }
        .sports-gallery-toggle { display: flex; align-items: center; }
        .sports-gallery-toggle svg { width: 1rem; height: 1rem; margin-left: 0.25rem; color: #64748b; }
        .sports-gallery-dropdown { position: absolute; display: none; margin-top: 0.5rem; width: 12rem; background-color: white; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); z-index: 10; border: 1px solid #f1f5f9; }
        .sports-gallery-dropdown.show { display: block; }
        .sports-gallery-dropdown .nav-link { font-size: 0.875rem; }
        main section { margin-bottom: 2.5rem; }
        main h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
        .match-schedule { display: grid; gap: 1rem; }
        .match-card { background-color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); border: 1px solid #e2e8f0; }
        .match-card-header { display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #64748b; margin-bottom: 0.5rem; }
        .match-card-header .status { font-weight: 700; }
        .match-card-header .status.live { color: #ef4444; }
        .match-card-header .status.finished { color: #64748b; }
        .match-card-body { display: flex; align-items: center; justify-content: space-around; }
        .match-card-body .team { font-weight: 700; font-size: 1.125rem; }
        .match-card-body .score { font-weight: 700; font-size: 1.5rem; }
        .popular-posts { background-color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .popular-posts ul { list-style: none; padding: 0; margin: 0; }
        .popular-posts li { padding-top: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px solid #f1f5f9; }
        .popular-posts li:last-child { border-bottom: none; }
        .popular-posts a { text-decoration: none; color: inherit; }
        .popular-posts a:hover { color: #059669; }
        .popular-posts .board-name { font-weight: 600; color: #64748b; }
        .popular-posts .comment-count { font-weight: 600; color: #ef4444; }
        .photo-gallery { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 1rem; }
        .photo-card { border-radius: 0.5rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); cursor: pointer; }
        .photo-card img { width: 100%; height: 10rem; object-fit: cover; transition: transform 0.3s ease; }
        .photo-card:hover img { transform: scale(1.05); }
        .photo-card .caption { padding: 0.5rem; background-color: white; }
        .photo-card .caption p { font-size: 0.875rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .board-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .write-btn { background-color: #059669; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer; }
        .write-btn:hover { background-color: #047857; }
        .table-container { background-color: white; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); overflow-x: auto; }
        .post-table { width: 100%; font-size: 0.875rem; text-align: left; color: #64748b; }
        .post-table thead { font-size: 0.75rem; color: #334155; text-transform: uppercase; background-color: #f8fafc; }
        .post-table th, .post-table td { padding: 0.75rem 1.5rem; }
        .post-table tbody tr { border-bottom: 1px solid #f1f5f9; }
        .post-table tbody tr:hover { background-color: #f8fafc; cursor: pointer; }
        .pagination { display: flex; justify-content: center; margin-top: 1rem; }
        .pagination button { padding: 0.25rem 0.75rem; margin: 0 0.25rem; border-radius: 0.5rem; border: 1px solid #cbd5e1; background-color: white; color: #334155; cursor: pointer; }
        .pagination button.active { background-color: #059669; color: white; border-color: #059669; }
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 50; }
        .modal-overlay.show { display: flex; }
        .modal-box { background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); width: 100%; max-width: 400px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .modal-header h2 { font-size: 1.25rem; font-weight: 700; }
        .modal-close-btn { font-size: 1.5rem; color: #64748b; cursor: pointer; border: none; background: none; }
        .modal-close-btn:hover { color: #1e293b; }
        .modal-body .form-group { margin-bottom: 1rem; }
        .modal-body label { display: block; margin-bottom: 0.25rem; font-weight: 600; }
        .modal-body input { width: 100%; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; box-sizing: border-box; }
        .modal-body button { width: 100%; padding: 0.75rem; border-radius: 0.5rem; background-color: #059669; color: white; font-weight: 600; border: none; cursor: pointer; }
        .modal-body button:hover { background-color: #047857; }
        .footer { background-color: #1e293b; color: white; margin-top: 2rem; }
        .footer .container { padding: 1.5rem; text-align: center; font-size: 0.875rem; }
        .footer p { margin-bottom: 0.5rem; }
        .footer .links { display: flex; justify-content: center; gap: 1rem; margin-bottom: 0.5rem; }
        .footer a { color: white; text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
        .footer .copyright { color: #94a3b8; }
        @media (min-width: 640px) { .header { flex-direction: row; } .header h1 { margin-bottom: 0; } .user-menu { margin-top: 0; } .main-nav ul { justify-content: flex-start; flex-wrap: nowrap; } .search-area { width: auto; } }
        @media (min-width: 768px) { .match-schedule { grid-template-columns: repeat(2, minmax(0, 1fr)); } .photo-gallery { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
        @media (min-width: 1024px) { .match-schedule { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        /* ê¸€ì“°ê¸° í¼ ìŠ¤íƒ€ì¼ */
        #write-form { padding: 1.5rem; background-color: white; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        #write-form input, #write-form textarea { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; box-sizing: border-box; margin-bottom: 1rem; }
        #write-form textarea { min-height: 250px; resize: vertical; }
        #write-form .form-actions { text-align: right; }
        /* ê²Œì‹œë¬¼ ë³´ê¸° ìŠ¤íƒ€ì¼ */
        #post-content-view { padding: 1.5rem; background-color: white; border-radius: 0.5rem; }
        #post-content-view h1 { font-size: 2rem; }
        #post-meta { color: #64748b; margin-bottom: 1.5rem; }
        #post-body { line-height: 1.8; min-height: 200px; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; padding: 2rem 0; }
        
        /* === ëŒ“ê¸€ ê¸°ëŠ¥ CSS ì¶”ê°€ START === */

        #comments-section {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        #comments-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        #comments-list {
            list-style: none;
            padding: 0;
        }

        .comment-item {
            padding: 1rem 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            font-weight: 700;
        }

        .comment-date {
            font-size: 0.875rem;
            color: #64748b;
        }

        .comment-body {
            margin-bottom: 0.5rem;
        }

        .comment-actions button {
            background: none;
            border: none;
            color: #64748b;
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.25rem;
        }
        .comment-actions button:hover {
            color: #059669;
        }

        /* ëŒ€ëŒ“ê¸€ ìŠ¤íƒ€ì¼ */
        .reply-list {
            list-style: none;
            padding-left: 2.5rem; /* ëŒ€ëŒ“ê¸€ ë“¤ì—¬ì“°ê¸° */
            border-left: 2px solid #e2e8f0;
            margin-top: 1rem;
        }

        /* ëŒ“ê¸€/ë‹µê¸€ ì‘ì„± í¼ */
        .comment-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .comment-form textarea {
            flex-grow: 1;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            padding: 0.75rem;
            resize: vertical;
            min-height: 40px;
        }
        .comment-form button {
            flex-shrink: 0;
            height: 42px; /* textarea ë†’ì´ì™€ ë§ì¶¤ */
        }

        .reply-form-container {
            padding-left: 2.5rem;
            margin-top: 1rem;
        }

        /* === ëŒ“ê¸€ ê¸°ëŠ¥ CSS ì¶”ê°€ END === */
   </style>
</head>
<body>

    <div id="app" class="container">
        
        <header class="header">
            <h1 id="logo">ìŠ¤í¬ì¸ íƒ€ìš´</h1>
            <div class="search-area">
                <input type="text" placeholder="í†µí•© ê²€ìƒ‰...">
                <button>ê²€ìƒ‰</button>
            </div>
            <div id="user-menu-container" class="user-menu">
                </div>
        </header>

        <nav class="main-nav">
            <ul>
                <li><a href="#" class="nav-link" data-board="freeboard">ììœ ê²Œì‹œíŒ</a></li>
                <li class="sports-gallery-menu" id="sports-gallery-menu">
                    <a href="#" id="sports-gallery-toggle" class="nav-link sports-gallery-toggle" data-board-group="sports">
                        ìŠ¤í¬ì¸ ê°¤ëŸ¬ë¦¬
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <div id="sports-gallery-dropdown" class="sports-gallery-dropdown">
                        <a href="#" class="nav-link" data-board="soccer">ì¶•êµ¬</a>
                        <a href="#" class="nav-link" data-board="baseball">ì•¼êµ¬</a>
                        <a href="#" class="nav-link" data-board="basketball">ë†êµ¬</a>
                        <a href="#" class="nav-link" data-board="esports">eìŠ¤í¬ì¸ </a>
                    </div>
                </li>
                <li><a href="#" class="nav-link" data-main-nav-link="true" data-board="announcements">ê³µì§€ì‚¬í•­</a></li>
            </ul>
        </nav>

        <main>
            <div id="main-view" class="view active">
                <section>
                    <h2>ì£¼ìš” ê²½ê¸°</h2>
                    <div id="match-schedule" class="match-schedule"></div>
                </section>
                <section>
                    <h2>ì»¤ë®¤ë‹ˆí‹° ì¸ê¸°ê¸€</h2>
                    <div id="popular-posts" class="popular-posts"></div>
                </section>
                <section>
    <h2>ğŸ¤– AI ìŠ¹ë¶€ ì˜ˆì¸¡</h2>
    <div id="prediction-ui" style="background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);">
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap;">
            <select id="ai-sport-select" style="padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
                <option value="soccer">ì¶•êµ¬</option>
                <option value="baseball">ì•¼êµ¬</option>
                <option value="basketball">ë†êµ¬</option>
                <option value="esports">eìŠ¤í¬ì¸ </option>
            </select>
            <input type="text" id="ai-team-a" placeholder="íŒ€ A ì´ë¦„" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <span style="font-weight: 700;">VS</span>
            <input type="text" id="ai-team-b" placeholder="íŒ€ B ì´ë¦„" style="flex-grow: 1; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem;">
            <button id="ai-predict-btn" class="write-btn">ì˜ˆì¸¡í•˜ê¸°</button>
        </div>
        <div id="ai-prediction-result" style="margin-top: 1rem; padding: 1rem; border: 1px dashed #e2e8f0; border-radius: 0.5rem; min-height: 50px; white-space: pre-wrap; line-height: 1.6;">
            ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>
</section>
            </div>

            <div id="board-view" class="view">
                <div class="board-header">
                    <h2 id="board-title"></h2>
                    <button id="write-post-btn" class="write-btn">ê¸€ì“°ê¸°</button>
                </div>
                <div class="table-container">
                    <table class="post-table">
                        <thead>
  <tr>
    <th>ë²ˆí˜¸</th><th>ì œëª©</th><th>ê¸€ì“´ì´</th><th>ì‘ì„±ì¼</th><th>ì¡°íšŒ</th><th>ì¶”ì²œ</th><th>ë¹„ì¶”ì²œ</th>
  </tr>
</thead>
                        <tbody id="post-list"></tbody>
                    </table>
                </div>
                <div id="pagination" class="pagination"></div>
            </div>

            <div id="post-view" class="view">
                </div>

            <div id="write-view" class="view">
                </div>
        </main>
    </div>
    
    <div id="login-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>ë¡œê·¸ì¸</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group"><label for="login-email">ì´ë©”ì¼</label><input type="email" id="login-email" required></div>
                    <div class="form-group"><label for="login-password">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="login-password" required></div>
                    <button type="submit">ë¡œê·¸ì¸</button>
                </form>
            </div>
        </div>
    </div>
    <div id="signup-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header"><h2>íšŒì›ê°€ì…</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-body">
               <form id="signup-form">
                    <div class="form-group"><label for="signup-nickname">ë‹‰ë„¤ì„</label><input type="text" id="signup-nickname" required></div>
                    <div class="form-group"><label for="signup-email">ì´ë©”ì¼</label><input type="email" id="signup-email" required></div>
                    <div class="form-group"><label for="signup-password">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="signup-password" minlength="6" required></div>
                    <button type="submit">ê°€ì…í•˜ê¸°</button>
               </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p style="font-weight: 700;">ìŠ¤í¬ì¸ íƒ€ìš´</p>
            <div class="links">
                <a href="#">íšŒì‚¬ì†Œê°œ</a><a href="#">ì´ìš©ì•½ê´€</a><a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a><a href="#">ê³ ê°ì„¼í„°</a>
            </div>
            <p class="copyright">Â© 2025 Sportstown. All Rights Reserved.</p>
        </div>
    </footer>

    <script type="module">
        // Firebase SDK IMPORTS
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
            onAuthStateChanged, signOut, updateProfile
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
  getFirestore, doc, setDoc, getDoc, getDocs, collection, 
  query, where, orderBy, limit, addDoc, serverTimestamp, increment, updateDoc,
  runTransaction // âœ… ì¶”ê°€
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAUuUlYHUwOuwnm_hsIsd7XHlj5voCecQk",
            authDomain: "community-d18d4.firebaseapp.com",
            projectId: "community-d18d4",
            storageBucket: "community-d18d4.appspot.com",
            messagingSenderId: "497702481194",
            appId: "1:497702481194:web:a826db91628adc24718253"
        };

        // FIREBASE INITIALIZATION
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // APP STATE
        const appState = {
            currentUser: null,
            currentView: 'main-view',
            currentBoard: null,
            currentPostId: null,
            currentPage: 1,
            postsPerPage: 10,
        };
        
        const boardNames = {
            freeboard: 'ììœ ê²Œì‹œíŒ', announcements: 'ê³µì§€ì‚¬í•­', soccer: 'ì¶•êµ¬', 
            baseball: 'ì•¼êµ¬', basketball: 'ë†êµ¬', esports: 'eìŠ¤í¬ì¸ ',
        };

        // === Firestore ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ===
        
        async function fetchMatches() {
            const matchesCol = collection(db, 'matches');
            const q = query(matchesCol, orderBy('time', 'desc'), limit(6));
            const snapshot = await getDocs(q);
            return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }
        
        async function fetchPopularPosts() {
            const postsCol = collection(db, 'posts');
            const q = query(postsCol, orderBy('likes', 'desc'), limit(5));
            const snapshot = await getDocs(q);
            return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function fetchPostsForBoard(boardId, page = 1) {
            const postsCol = collection(db, 'posts');
            // ì°¸ê³ : Firestore í˜ì´ì§€ë„¤ì´ì…˜ì€ ë” ë³µì¡í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ìµœì‹  ê¸€ Nê°œë§Œ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ë‹¨ìˆœí™”
            const q = query(postsCol, where("board", "==", boardId), orderBy("createdAt", "desc"), limit(appState.postsPerPage));
            const snapshot = await getDocs(q);
            return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        // === UI ë Œë”ë§ í•¨ìˆ˜ ===

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            const viewToShow = document.getElementById(viewId);
            if(viewToShow) {
                viewToShow.classList.add('active');
                appState.currentView = viewId;
                window.scrollTo(0, 0);
            }
        }

        // ë³€ê²½: Firestoreì—ì„œ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
        async function renderMainView() {
            showView('main-view');
            
            // ê²½ê¸° ì •ë³´ ë Œë”ë§
            const matches = await fetchMatches();
            const matchContainer = document.getElementById('match-schedule');
            matchContainer.innerHTML = matches.map(match => `
                <div class="match-card">
                    <div class="match-card-header">
                        <span>${boardNames[match.sport] || match.sport}</span>
                        <span class="status ${match.time === 'ì¢…ë£Œ' ? 'finished' : 'live'}">${match.time}</span>
                    </div>
                    <div class="match-card-body">
                        <span class="team">${match.teamA}</span>
                        <span class="score">${match.scoreA} : ${match.scoreB}</span>
                        <span class="team">${match.teamB}</span>
                    </div>
                </div>
            `).join('') || "<p>ë“±ë¡ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";

    // ì¸ê¸°ê¸€ ë Œë”ë§
    const popularPosts = await fetchPopularPosts();
    const popularPostsContainer = document.getElementById('popular-posts');
    popularPostsContainer.innerHTML = `<ul>${popularPosts.map(post => `
        <li>
            <a href="#" class="post-link" data-post-id="${post.id}" data-board="${post.board}">
                <span class="board-name">[${boardNames[post.board]}]</span> ${post.title} 
                <span class="comment-count">[${post.commentCount || 0}]</span>
            </a>
        </li>
    `).join('')}</ul>` || "<p>ì¸ê¸°ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        }


// === AI ìŠ¹ë¶€ ì˜ˆì¸¡ ê¸°ëŠ¥ ì¶”ê°€ START ===

async function handlePrediction(e) {
    const sport = document.getElementById('ai-sport-select').value;
    const teamA = document.getElementById('ai-team-a').value.trim();
    const teamB = document.getElementById('ai-team-b').value.trim();
    const resultDiv = document.getElementById('ai-prediction-result');
    const predictBtn = document.getElementById('ai-predict-btn');

    if (!teamA || !teamB) {
        alert('íŒ€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
    }

    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    resultDiv.textContent = 'ğŸ§  AIê°€ ì—´ì‹¬íˆ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...';
    predictBtn.disabled = true;
    predictBtn.textContent = 'ë¶„ì„ì¤‘...';

    try {
        const response = await fetch('/api/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ sport, teamA, teamB }),
        });

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        resultDiv.textContent = data.prediction;

    } catch (error) {
        console.error('Prediction Error:', error);
        resultDiv.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
    } finally {
        // ë¡œë”© ìƒíƒœ í•´ì œ
        predictBtn.disabled = false;
        predictBtn.textContent = 'ì˜ˆì¸¡í•˜ê¸°';
    }
}

// ì˜ˆì¸¡ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
// ì´ ì½”ë“œëŠ” renderMainView í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ì— ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ,
// ì´ˆê¸° ë Œë”ë§ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í•œ ë²ˆë§Œ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
document.addEventListener('DOMContentLoaded', () => {
    // ë²„íŠ¼ì´ ë‚˜ì¤‘ì— ìƒì„±ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìƒìœ„ ìš”ì†Œì— ì´ë²¤íŠ¸ ìœ„ì„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    document.body.addEventListener('click', function(event) {
        if (event.target && event.target.id === 'ai-predict-btn') {
            handlePrediction();
        }
    });
});



        
        // ë³€ê²½: Firestoreì—ì„œ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
        async function renderBoardView(boardId, page) {
  appState.currentBoard = boardId;
  appState.currentPage = page;
  showView('board-view');

  document.getElementById('board-title').textContent = boardNames[boardId] + " ê²Œì‹œíŒ";

    const posts = await fetchPostsForBoard(boardId, page);
    const postList = document.getElementById('post-list');
    const formatDate = (timestamp) =>
        timestamp ? new Date(timestamp.seconds * 1000).toLocaleDateString('ko-KR') : 'ë°©ê¸ˆ';

    postList.innerHTML =
        posts.map((post, index) => `
        <tr class="post-link" data-post-id="${post.id}" data-board="${post.board}">
            <td>${index + 1}</td>
            <td>${post.title} <span class="comment-count">[${post.commentCount || 0}]</span></td>
            <td>${post.authorName}</td>
            <td>${formatDate(post.createdAt)}</td>
            <td>${post.views || 0}</td>
            <td>${post.likes || 0}</td>
            <td>${post.dislikes || 0}</td>
        </tr>
    `).join('') || '<tr><td colspan="7">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
}

        // ì¶”ê°€: ê¸€ì“°ê¸° í¼ ë Œë”ë§
        function renderWriteView() {
            const boardId = appState.currentBoard;
            if (!appState.currentUser) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                return;
            }
            showView('write-view');
            const writeView = document.getElementById('write-view');
            writeView.innerHTML = `
                <h2>${boardNames[boardId]} ê¸€ì“°ê¸°</h2>
                <form id="write-form">
                    <input type="text" id="write-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <textarea id="write-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                    <div class="form-actions">
                        <button type="button" id="cancel-write-btn" class="write-btn" style="background-color:#64748b;">ì·¨ì†Œ</button>
                        <button type="submit" class="write-btn">ë“±ë¡</button>
                    </div>
                </form>
            `;
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            document.getElementById('write-form').addEventListener('submit', handlePostSubmit);
            document.getElementById('cancel-write-btn').addEventListener('click', () => renderBoardView(appState.currentBoard, 1));
        }

        // ì¶”ê°€: ê²Œì‹œë¬¼ ë³´ê¸° ë Œë”ë§
  // âœ… ê¸°ì¡´ renderPostView í•¨ìˆ˜ë¥¼ ì•„ë˜ ì½”ë“œë¡œ ì™„ì „íˆ êµì²´í•˜ì„¸ìš”.
async function renderPostView(boardId, postId) {
    showView('post-view');
    appState.currentPostId = postId; // í˜„ì¬ ê²Œì‹œë¬¼ ID ì €ì¥
    const postRef = doc(db, "posts", postId);
    
    // ì¡°íšŒìˆ˜ 1 ì¦ê°€
    await updateDoc(postRef, { views: increment(1) });
    
    const postSnap = await getDoc(postRef);

    if (postSnap.exists()) {
        const post = postSnap.data();
        const postView = document.getElementById('post-view');
        const formatDate = (timestamp) => timestamp ? new Date(timestamp.seconds * 1000).toLocaleString('ko-KR') : '';
        
        // 1. ê²Œì‹œë¬¼, ì¶”ì²œ/ë¹„ì¶”ì²œ, ëŒ“ê¸€ ì„¹ì…˜ì˜ ê¸°ë³¸ HTML êµ¬ì¡°ë¥¼ ëª¨ë‘ ê·¸ë¦½ë‹ˆë‹¤.
        postView.innerHTML = `
            <div id="post-content-view">
                <h1>${post.title}</h1>
                <div id="post-meta">
                    <span>ì‘ì„±ì: ${post.authorName}</span> | 
                    <span>ì‘ì„±ì¼: ${formatDate(post.createdAt)}</span> |
                    <span>ì¡°íšŒ: ${post.views || 1}</span>
                </div>
                <div id="post-body">${post.content.replace(/\n/g, '<br>')}</div>

                <div id="vote-bar" style="display:flex; gap:.5rem; align-items:center; margin:1rem 0;">
                    <button id="like-btn" class="write-btn" style="background:#16a34a;">
                        ğŸ‘ ì¶”ì²œ <span id="like-count">${post.likes || 0}</span>
                    </button>
                    <button id="dislike-btn" class="write-btn" style="background:#ef4444;">
                        ğŸ‘ ë¹„ì¶”ì²œ <span id="dislike-count">${post.dislikes || 0}</span>
                    </button>
                </div>

                <button id="back-to-list-btn" class="write-btn">ëª©ë¡ìœ¼ë¡œ</button>
            </div>
            
            <div id="comments-section">
                <h3>ëŒ“ê¸€</h3>
                <ul id="comments-list"></ul>
                ${appState.currentUser ? `
                    <form id="comment-form" class="comment-form">
                        <textarea id="comment-text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                        <button type="submit" class="write-btn">ë“±ë¡</button>
                    </form>
                ` : `<p style="text-align:center; color:#64748b;">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>`}
            </div>
        `;

        // --- ê¸°ëŠ¥ ì‹¤í–‰ ---
        // 2. ì¶”ì²œ/ë¹„ì¶”ì²œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ê¸°ëŠ¥ì„ ì—°ê²°í•©ë‹ˆë‹¤. (ì´ ë¶€ë¶„ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤)
        setupVoteUI(postId);
        
        // 3. ëŒ“ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
        renderComments(postId);
        
        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
        document.getElementById('back-to-list-btn').addEventListener('click', () => renderBoardView(boardId, 1));
        if (appState.currentUser) {
            document.getElementById('comment-form').addEventListener('submit', (e) => handleCommentSubmit(e, postId));
        }

    } else {
        alert("ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        renderBoardView(boardId, 1);
    }
}

        // renderPostView í•¨ìˆ˜ ì•„ë˜ì— ì•„ë˜ í•¨ìˆ˜ë“¤ì„ ëª¨ë‘ ì¶”ê°€í•˜ì„¸ìš”.

// === ëŒ“ê¸€ ê¸°ëŠ¥ í•¨ìˆ˜ START ===

// ëŒ“ê¸€ ë Œë”ë§ ë©”ì¸ í•¨ìˆ˜
async function renderComments(postId) {
    const commentsList = document.getElementById('comments-list');
    commentsList.innerHTML = '<li>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>';

    // 1. ëª¨ë“  ëŒ“ê¸€ì„ ê°€ì ¸ì™€ IDë¥¼ í‚¤ë¡œ í•˜ëŠ” ë§µìœ¼ë¡œ ë³€í™˜
    const commentsCol = collection(db, "posts", postId, "comments");
    const q = query(commentsCol, orderBy("createdAt"));
    const snapshot = await getDocs(q);
    
    const commentsMap = new Map();
    snapshot.docs.forEach(doc => {
        commentsMap.set(doc.id, { id: doc.id, children: [], ...doc.data() });
    });

    // 2. ë¶€ëª¨-ìì‹ ê´€ê³„ë¥¼ êµ¬ì¶•
    const rootComments = [];
    commentsMap.forEach(comment => {
        if (comment.parentId && commentsMap.has(comment.parentId)) {
            commentsMap.get(comment.parentId).children.push(comment);
        } else {
            rootComments.push(comment);
        }
    });

    // 3. ìµœìƒìœ„ ëŒ“ê¸€ë¶€í„° ì¬ê·€ì ìœ¼ë¡œ HTML ìƒì„±
    commentsList.innerHTML = '';
    if (rootComments.length === 0) {
        commentsList.innerHTML = '<li>ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
    }
    rootComments.forEach(comment => {
        const li = createCommentElement(comment);
        commentsList.appendChild(li);
    });
}

// ê°œë³„ ëŒ“ê¸€ ì—˜ë¦¬ë¨¼íŠ¸(<li>)ë¥¼ ìƒì„±í•˜ëŠ” ì¬ê·€ í•¨ìˆ˜
function createCommentElement(comment) {
    const li = document.createElement('li');
    li.className = 'comment-item';
    li.id = `comment-${comment.id}`;
    const formatDate = (ts) => ts ? new Date(ts.seconds * 1000).toLocaleString('ko-KR') : '';

    li.innerHTML = `
        <div class="comment-header">
            <span class="comment-author">${comment.authorName}</span>
            <span class="comment-date">${formatDate(comment.createdAt)}</span>
        </div>
        <p class="comment-body">${comment.text.replace(/\n/g, '<br>')}</p>
        <div class="comment-actions">
            ${appState.currentUser ? `<button class="reply-btn" data-comment-id="${comment.id}">ë‹µê¸€ ë‹¬ê¸°</button>` : ''}
        </div>
    `;

    // ë‹µê¸€(ìì‹ ëŒ“ê¸€)ì´ ìˆìœ¼ë©´ ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬
    if (comment.children.length > 0) {
        const replyList = document.createElement('ul');
        replyList.className = 'reply-list';
        comment.children.forEach(reply => {
            replyList.appendChild(createCommentElement(reply));
        });
        li.appendChild(replyList);
    }
    
    // 'ë‹µê¸€ ë‹¬ê¸°' ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    li.querySelector('.reply-btn')?.addEventListener('click', showReplyForm);

    return li;
}

// ë‹µê¸€ í¼ì„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
function showReplyForm(e) {
    const parentCommentId = e.target.dataset.commentId;
    const parentCommentItem = document.getElementById(`comment-${parentCommentId}`);

    // ì´ë¯¸ ë‹µê¸€ í¼ì´ ìˆë‹¤ë©´ ì œê±°
    const existingForm = parentCommentItem.querySelector('.reply-form-container');
    if (existingForm) {
        existingForm.remove();
        return;
    }
    
    const formContainer = document.createElement('div');
    formContainer.className = 'reply-form-container';
    formContainer.innerHTML = `
        <form class="comment-form reply-form">
            <textarea placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
            <button type="submit" class="write-btn">ë“±ë¡</button>
        </form>
    `;

    // ìƒì„±ëœ í¼ì˜ submit ì´ë²¤íŠ¸ ì²˜ë¦¬
    formContainer.querySelector('.reply-form').addEventListener('submit', (event) => {
        handleCommentSubmit(event, appState.currentPostId, parentCommentId);
    });

    parentCommentItem.appendChild(formContainer);
    formContainer.querySelector('textarea').focus();
}

// ëŒ“ê¸€/ë‹µê¸€ ì œì¶œ ì²˜ë¦¬ í•¨ìˆ˜
// âœ… handleCommentSubmit í•¨ìˆ˜ë¥¼ ì•„ë˜ ì½”ë“œë¡œ ìˆ˜ì •í•˜ì„¸ìš”.
async function handleCommentSubmit(e, postId, parentId = null) {
    e.preventDefault();
    const user = appState.currentUser;
    if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
    }

    const textarea = e.target.querySelector('textarea');
    const text = textarea.value.trim();
    if (!text) return;

    try {
        // ëŒ“ê¸€ ë°ì´í„° ì¶”ê°€
        const commentsCol = collection(db, "posts", postId, "comments");
        const commentData = {
            text: text,
            authorId: user.uid,
            authorName: user.nickname,
            createdAt: serverTimestamp(),
        };
        if (parentId) {
            commentData.parentId = parentId;
        }
        await addDoc(commentsCol, commentData);

        // âœ… ì¶”ê°€: ê²Œì‹œë¬¼ì˜ commentCount í•„ë“œ 1 ì¦ê°€
        const postRef = doc(db, "posts", postId);
        await updateDoc(postRef, { commentCount: increment(1) });
        
        // UI ê°±ì‹ 
        textarea.value = '';
        const formContainer = e.target.closest('.reply-form-container');
        if(formContainer) formContainer.remove();
        renderComments(postId);

    } catch (error) {
        console.error("ëŒ“ê¸€ ë“±ë¡ ì˜¤ë¥˜: ", error);
        alert("ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
}

// === ëŒ“ê¸€ ê¸°ëŠ¥ í•¨ìˆ˜ END ===


        async function setupVoteUI(postId) {
  const likeBtn = document.getElementById('like-btn');
  const dislikeBtn = document.getElementById('dislike-btn');

  likeBtn.addEventListener('click', () => handleVote(postId, 1));
  dislikeBtn.addEventListener('click', () => handleVote(postId, -1));

  // ë¡œê·¸ì¸ ì•ˆëìœ¼ë©´ ìƒíƒœí‘œì‹œ ìƒëµ
  const user = appState.currentUser;
  if (!user) return;

  const voteRef = doc(db, "posts", postId, "votes", user.uid);
  const snap = await getDoc(voteRef);
  if (snap.exists()) {
    const v = snap.data().value;
    if (v === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
    if (v === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
  }
}

// âœ… íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì¶”ì²œ/ë¹„ì¶”ì²œ ì²˜ë¦¬ (ë‹¨ì¼ê³„ì • 1í‘œ, ì·¨ì†Œ/ì „í™˜ ì§€ì›)
async function handleVote(postId, value) {
  // value: 1=ì¶”ì²œ, -1=ë¹„ì¶”ì²œ
  const user = appState.currentUser;
  if (!user) { alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); return; }

  const postRef = doc(db, "posts", postId);
  const voteRef = doc(db, "posts", postId, "votes", user.uid);

  try {
    await runTransaction(db, async (tx) => {
      const [postSnap, voteSnap] = await Promise.all([tx.get(postRef), tx.get(voteRef)]);
      if (!postSnap.exists()) throw new Error("ê²Œì‹œë¬¼ ì—†ìŒ");

      let likes = postSnap.data().likes || 0;
      let dislikes = postSnap.data().dislikes || 0;

      if (!voteSnap.exists()) {
        // ì²« íˆ¬í‘œ
        if (value === 1) likes += 1;
        else dislikes += 1;
        tx.set(voteRef, { value, createdAt: serverTimestamp() });
      } else {
        const prev = voteSnap.data().value; // 1 or -1
        if (prev === value) {
          // ê°™ì€ ìª½ ì¬í´ë¦­ = ì·¨ì†Œ
          if (value === 1) likes -= 1;
          else dislikes -= 1;
          tx.delete(voteRef);
        } else {
          // ë°©í–¥ ì „í™˜
          if (value === 1) { likes += 1; dislikes -= 1; }
          else { dislikes += 1; likes -= 1; }
          tx.update(voteRef, { value, createdAt: serverTimestamp() });
        }
      }

      tx.update(postRef, { likes, dislikes });
    });

    // í™”ë©´ ì¹´ìš´íŠ¸ ê°±ì‹ 
    const latest = (await getDoc(postRef)).data();
    document.getElementById('like-count').textContent = latest.likes || 0;
    document.getElementById('dislike-count').textContent = latest.dislikes || 0;

    // ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸ ê°±ì‹ 
    const likeBtn = document.getElementById('like-btn');
    const dislikeBtn = document.getElementById('dislike-btn');
    likeBtn.style.outline = "";
    dislikeBtn.style.outline = "";

    const myVote = await getDoc(doc(db, "posts", postId, "votes", appState.currentUser.uid));
    if (myVote.exists()) {
      if (myVote.data().value === 1) likeBtn.style.outline = "3px solid rgba(34,197,94,.4)";
      if (myVote.data().value === -1) dislikeBtn.style.outline = "3px solid rgba(239,68,68,.4)";
    }

  } catch (e) {
    console.error(e);
    alert("íˆ¬í‘œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
}
        
        // === ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ===

        // ì¶”ê°€: ê¸€ì“°ê¸° ì œì¶œ í•¸ë“¤ëŸ¬
// âœ… handlePostSubmit í•¨ìˆ˜ë¥¼ ì•„ë˜ ì½”ë“œë¡œ ìˆ˜ì •í•˜ì„¸ìš”.
async function handlePostSubmit(e) {
    e.preventDefault();
    const title = document.getElementById('write-title').value;
    const content = document.getElementById('write-content').value;
    const user = appState.currentUser;

    if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
    }

    try {
        const postsCol = collection(db, 'posts');
        await addDoc(postsCol, {
            title,
            content,
            authorId: user.uid,
            authorName: user.nickname,
            board: appState.currentBoard,
            createdAt: serverTimestamp(),
            views: 0,
            likes: 0,
            dislikes: 0,
            commentCount: 0, // âœ… ì¶”ê°€: ëŒ“ê¸€ ì¹´ìš´í„° ì´ˆê¸°í™”
            comments: [] // ì´ í•„ë“œëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
        });
        
        const siteStatsDocRef = doc(db, 'siteStats', 'summary');
        await setDoc(siteStatsDocRef, { totalPosts: increment(1) }, { merge: true });

        alert("ê²Œì‹œë¬¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        renderBoardView(appState.currentBoard, 1);

    } catch (error) {
        console.error("ê²Œì‹œë¬¼ ë“±ë¡ ì˜¤ë¥˜: ", error);
        alert("ê²Œì‹œë¬¼ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
}
        
        // --- AUTHENTICATION LOGIC ---
        const userMenuContainer = document.getElementById('user-menu-container');
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDocRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userDocRef);
                const nickname = userDoc.exists() ? userDoc.data().nickname : user.email.split('@')[0];
                
                appState.currentUser = { uid: user.uid, email: user.email, nickname: nickname };

                userMenuContainer.innerHTML = `
                    <span>${nickname}ë‹˜</span>
                    <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
                `;
                document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
            } else {
                appState.currentUser = null;
                userMenuContainer.innerHTML = `
                    <a href="#" id="login-btn">ë¡œê·¸ì¸</a>
                    <a href="#" id="signup-btn">íšŒì›ê°€ì…</a>
                `;
                document.getElementById('login-btn').addEventListener('click', (e) => { e.preventDefault(); loginModal.classList.add('show'); });
                document.getElementById('signup-btn').addEventListener('click', (e) => { e.preventDefault(); signupModal.classList.add('show'); });
            }
        });
        
        // íšŒì›ê°€ì… í¼
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nickname = document.getElementById('signup-nickname').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await updateProfile(user, { displayName: nickname });
                await setDoc(doc(db, "users", user.uid), { nickname: nickname, email: email });
                alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                signupModal.classList.remove('show');
            } catch (error) { alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${error.message}`); }
        });

        // ë¡œê·¸ì¸ í¼
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                loginModal.classList.remove('show');
            } catch (error) { alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`); }
        });

        // --- GLOBAL EVENT LISTENERS ---
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('show'); });
        });
        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', () => { btn.closest('.modal-overlay').classList.remove('show'); });
        });

        const sportsGalleryToggle = document.getElementById('sports-gallery-toggle');
        const sportsGalleryDropdown = document.getElementById('sports-gallery-dropdown');

        sportsGalleryToggle.addEventListener('click', (e) => {
            e.preventDefault();
            sportsGalleryDropdown.classList.toggle('show');
        });

        document.addEventListener('click', (e) => {
            if (!document.getElementById('sports-gallery-menu').contains(e.target)) {
                sportsGalleryDropdown.classList.remove('show');
            }
        });

        document.getElementById('app').addEventListener('click', (e) => {
            const navLink = e.target.closest('.nav-link');
            if (navLink && navLink.dataset.board) {
                e.preventDefault();
                renderBoardView(navLink.dataset.board, 1);
                sportsGalleryDropdown.classList.remove('show');
                return;
            }

            const postLink = e.target.closest('.post-link');
            if (postLink) {
                e.preventDefault();
                const postId = postLink.dataset.postId;
                const boardId = postLink.dataset.board;
                renderPostView(boardId, postId);
                return;
            }
        });

        document.getElementById('logo').addEventListener('click', renderMainView);
        document.getElementById('write-post-btn').addEventListener('click', renderWriteView);
        
        // Initial Render
        renderMainView();
    </script>
</body>
</html>