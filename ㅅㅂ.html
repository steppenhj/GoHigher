<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polygon API í†µí•© í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { padding: 8px; margin: 5px; }
    h2 { margin-top: 30px; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>

  <h1>ğŸ“Š Polygon í†µí•© ì£¼ì‹ ë°ì´í„°</h1>
  <input type="text" id="tickerInput" placeholder="í‹°ì»¤ ì…ë ¥ (ì˜ˆ: AAPL)">
  <button id="searchBtn">ê²€ìƒ‰</button>

  <div id="newsSection" class="section">
    <h2>ğŸ“° ë‰´ìŠ¤</h2>
    <div id="newsContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <div id="priceSection" class="section">
    <h2>ğŸ’µ ì‹¤ì‹œê°„ ì£¼ê°€</h2>
    <div id="priceContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <div id="closeSection" class="section">
    <h2>ğŸ”’ ì „ì¼ ì¢…ê°€</h2>
    <div id="closeContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <div id="chartSection" class="section">
    <h2>ğŸ“ˆ ì¼ë´‰ ì°¨íŠ¸</h2>
    <div id="chartContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <div id="infoSection" class="section">
    <h2>ğŸ¢ ê¸°ì—… ì •ë³´</h2>
    <div id="infoContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <div id="dividendSection" class="section">
    <h2>ğŸ’° ë°°ë‹¹ê¸ˆ</h2>
    <div id="dividendContainer">ë°ì´í„° ì—†ìŒ</div>
  </div>

  <script>
    document.getElementById('searchBtn').addEventListener('click', async () => {
      const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
      if (!ticker) {
        alert('í‹°ì»¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      // ë‚ ì§œ ì„¸íŒ…
      const today = new Date();
      const to = today.toISOString().split('T')[0];
      const fromDate = new Date();
      fromDate.setDate(today.getDate() - 7);
      const from = fromDate.toISOString().split('T')[0];

      const baseUrl = 'https://us-central1-gohigher-55e51.cloudfunctions.net/polygonApi';

      // ë¡œë”© í‘œì‹œ
      document.getElementById('newsContainer').innerHTML = 'ë¡œë”© ì¤‘...';
      document.getElementById('priceContainer').innerHTML = 'ë¡œë”© ì¤‘...';
      document.getElementById('closeContainer').innerHTML = 'ë¡œë”© ì¤‘...';
      document.getElementById('chartContainer').innerHTML = 'ë¡œë”© ì¤‘...';
      document.getElementById('infoContainer').innerHTML = 'ë¡œë”© ì¤‘...';
      document.getElementById('dividendContainer').innerHTML = 'ë¡œë”© ì¤‘...';

      try {
        // ë‰´ìŠ¤
        const newsRes = await fetch(`${baseUrl}/news?limit=5`);
        const newsData = await newsRes.json();
        const newsContainer = document.getElementById('newsContainer');
        newsContainer.innerHTML = '';
        newsData.results.forEach(news => {
          const newsItem = document.createElement('div');
          newsItem.style.marginBottom = '20px';
          newsItem.innerHTML = `
            <h3>${news.title}</h3>
            <p>${news.description}</p>
            <a href="${news.article_url}" target="_blank">ê¸°ì‚¬ ë³´ê¸°</a>
          `;
          newsContainer.appendChild(newsItem);
        });

        // ì‹¤ì‹œê°„ ì£¼ê°€
        const priceRes = await fetch(`${baseUrl}/price?ticker=${ticker}`);
        const priceData = await priceRes.json();
        document.getElementById('priceContainer').innerHTML = `í˜„ì¬ê°€: ${priceData.price}`;

        // ì „ì¼ ì¢…ê°€
        const closeRes = await fetch(`${baseUrl}/previousclose?ticker=${ticker}`);
        const closeData = await closeRes.json();
        document.getElementById('closeContainer').innerHTML = `ì „ì¼ ì¢…ê°€: ${closeData.previousClose}`;

        // ì¼ë´‰ ì°¨íŠ¸
        const chartRes = await fetch(`${baseUrl}/dailychart?ticker=${ticker}&from=${from}&to=${to}`);
        const chartData = await chartRes.json();
        document.getElementById('chartContainer').innerHTML = chartData.chartData.map(item => `ë‚ ì§œ: ${item.date}, ì¢…ê°€: ${item.close}`).join('<br>');

        // ê¸°ì—… ì •ë³´
        const infoRes = await fetch(`${baseUrl}/info?ticker=${ticker}`);
        const infoData = await infoRes.json();
        document.getElementById('infoContainer').innerHTML = `
          <strong>íšŒì‚¬ëª…:</strong> ${infoData.name}<br>
          <strong>ì„¹í„°:</strong> ${infoData.sector}<br>
          <strong>ì„¤ëª…:</strong> ${infoData.description}
        `;

        // ë°°ë‹¹ê¸ˆ
        const dividendRes = await fetch(`${baseUrl}/dividends?ticker=${ticker}`);
        const dividendData = await dividendRes.json();
        document.getElementById('dividendContainer').innerHTML = dividendData.dividends.map(item => `ë‚ ì§œ: ${item.date}, ê¸ˆì•¡: ${item.amount}`).join('<br>');

      } catch (error) {
        console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
